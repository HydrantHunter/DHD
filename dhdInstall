--[[ DHD/Gate Installer ]]--
--[[   version 1.0.02   ]]--
--[[  by HydrantHunter  ]]--
--[[      aka Dog       ]]--
--[[ pastebin  A6uxKyCy ]]--
local iVer = "1.0"
--[[
Test with/Requires:
  - Minecraft 1.6.4
  - HTTP API enabled (for this installer only)
  - LanteaCraft (snapshot 82)
  - ComputerCraft 1.57+ for MC 1.6.4
    - ccDHD: Advanced Computer (color, mouse), 4 optional Advanced Monitors (color, touch), optional Biolock
    - gateLiaison: Advanced Computer (color, mouse), 3 optional Advanced Monitors (color)
]]--
local startup

local function downloadFile(fileToken, fileName)
  local fileURL = http.get("http://pastebin.com/raw.php?i="..textutils.urlEncode(fileToken))
  if fileURL then
    local fileContents = fileURL.readAll()
    fileURL.close()
    local newFile = fs.open(fileName, "w")
    newFile.write(fileContents)
    newFile.close()
  end
end

local function drawHeader()
  term.setBackgroundColor(colors.black)
  term.clear()
  term.setBackgroundColor(colors.lightBlue)
  term.setTextColor(colors.black)
  term.setCursorPos(2,1)
  term.write("                   ")
  term.setCursorPos(2,2)
  term.write(" DHD Installer " .. iVer .. " ")
  term.setCursorPos(2,3)
  term.write("                   ")
end

local function drawCLI()
  term.setBackgroundColor(colors.black)
  term.setCursorPos(1,6)
  if fs.exists("DHD") or (startup == 2 and fs.exists("startup")) then
    term.setTextColor(colors.lime)
    term.write(" [                 ] ")
    term.setCursorPos(5,6)
    term.setTextColor(colors.lightGray)
    term.write("DHD Installed")
  else
    term.setTextColor(colors.white)
    term.write(" [   Install DHD   ] ")
  end
  term.setCursorPos(1,8)
  if fs.exists("gateLiaison") or (startup == 3 and fs.exists("startup")) then
    term.setTextColor(colors.lime)
    term.write(" [                 ] ")
    term.setCursorPos(4,8)
    term.setTextColor(colors.lightGray)
    term.write("Gate  Installed")
  else
    term.setTextColor(colors.white)
    term.write(" [  Install  Gate  ] ")
  end
  term.setTextColor(colors.orange)
  term.setCursorPos(1,10)
  term.write(" [                 ] ")
  term.setTextColor(colors.white)
  term.setCursorPos(9,10)
  term.write("Reboot")
  term.setTextColor(colors.red)
  term.setCursorPos(1,12)
  term.write(" [                 ] ")
  term.setTextColor(colors.white)
  term.setCursorPos(10,12)
  term.write("Quit")
end

local function setCCLabel(whichType)
  local currentCCLabel = os.getComputerLabel()
  local currentCCID = tostring(os.getComputerID())
  if currentCCLabel ~= "" and currentCCLabel ~= nil then return end
  if whichType == "gate" then
    os.setComputerLabel("Gate - CC# " .. currentCCID)
  elseif whichType == "dhd" then
    os.setComputerLabel("DHD - CC# " .. currentCCID)
  end
end

local function cleanUp()
  if fs.exists("/logs/DHDlast") then
    fs.move("/logs/DHDlast","/data/DHDlast")
  end
  if fs.exists("/logs/DHDhistory") then
    fs.move("/logs/DHDhistory","/data/DHDhistory")
  end
  if fs.exists("/logs") then fs.delete("logs") end
end

drawHeader()
drawCLI()

while true do
  userInput = { os.pullEvent("mouse_click") }
  if userInput[3] > 1 and userInput[3] < 21 then
    if userInput[4] == 6 then
      setCCLabel("dhd")
      if fs.exists("logs") then fs.delete("/data/DHDsettings") end
      if not fs.exists("data") then
        fs.makeDir("data")
      end
      cleanUp()
      if fs.exists("startup") then
        if fs.exists("DHD") then
          fs.delete("DHD")
        end
        downloadFile("vMtcSz2e","DHD")
        startup = 1
      else
        downloadFile("vMtcSz2e","startup")
        startup = 2
      end
      drawCLI()
    elseif userInput[4] == 8 then
      setCCLabel("gate")
      if fs.exists("logs") then fs.delete("/data/gateSettings") end
      if not fs.exists("data") then
        fs.makeDir("data")
      end
      cleanUp()
      if fs.exists("startup") then
        if fs.exists("gateLiaison") then
          fs.delete("gateLiaison")
        end
        downloadFile("xSHHqL0h","gateLiaison")
        startup = 1
      else
        downloadFile("xSHHqL0h","startup")
        startup = 3
      end
      drawCLI()
    elseif userInput[4] == 10 then
      os.reboot()
    elseif userInput[4] == 12 then
      term.clear()
      term.setCursorPos(1,1)
      break
    end
  end
end
